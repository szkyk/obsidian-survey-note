# Obsidian Survey Note Plugin

Obsidian用のSurveyNoteプラグインです。ノートを構造化されたグリッドレイアウトで整理・編集できます。

## 機能

### 主な機能
- **動的なグリッドレイアウト**:
  - **上段（目的・まとめ）**: フォントサイズ設定に連動した4行分の固定高さを持ち、内容が多ければセクション内でスクロールします。
  - **下段（内容など）**: ウィンドウの高さに応じて柔軟に伸縮し、コンテンツが増えた場合はページ全体がスクロールします。
- **ビューの切り替え**: 通常のMarkdownビューとSurveyNoteビューをコマンドやアイコンから簡単に切り替えられます。
- **リッチなMarkdown編集**: 各セクションは、Minimalテーマ風のスタイルが適用された高機能なMarkdownエディタ（CodeMirror）で編集できます。
- **フォーカス表示**: 編集中のセクションがハイライトされ、どこを編集しているかが一目でわかります。
- **コードブロックのスタイル**: コードブロックが背景色付きで見やすく表示されます。
- **タイトル編集**: SurveyNoteビューのタイトルを直接編集することで、ファイル名を変更できます。
- **画像のドラッグ＆ドロップ**: エディタに画像を直接ドラッグ＆ドロップして埋め込むことができます。
- **自動保存**: 編集内容はリアルタイムで自動的にMarkdownファイルに保存されます。
- **カスタマイズ可能なUI**: 設定画面からエディタのフォントサイズやテーマ（ライト/ダーク/自動）を調整できます。

### リンク機能
- **内部リンク**: `[[ファイル名]]` 形式でObsidian内の他のファイルにリンクできます。クリックすると該当ファイルが開きます。
- **URLリンク**: `[表示名](URL)` 形式でWebリンクを作成できます。カーソルが範囲外の場合は表示名のみが表示され、範囲内の場合は元のMarkdown形式が表示されます。クリックするとブラウザでURLが開きます。
- **単体URL**: `https://example.com` 形式の単体URLも自動認識され、クリック可能なリンクとして表示されます。

### 画像機能
- **画像インラインプレビュー**: `![[画像ファイル名]]` 形式で画像をインライン表示できます。ドラッグ＆ドロップで挿入した画像も自動的にプレビューされます。
- **画像サイズ指定**: `![[画像ファイル名|300x200]]` 形式で画像のサイズを指定できます。
  - `![[image.png|300x200]]` - 幅300px、高さ200px
  - `![[image.png|300]]` - 幅300px、高さ自動調整
  - `![[image.png|x200]]` - 幅自動調整、高さ200px
- **画像配置指定**: `![[画像ファイル名|配置]]` 形式で画像の配置を指定できます。
  - `![[image.png|left]]` - 左寄せ（デフォルト）
  - `![[image.png|center]]` - 中央寄せ
  - `![[image.png|right]]` - 右寄せ
  - `![[image.png|center|300x200]]` - 配置とサイズの組み合わせも可能
- **編集モード**: カーソルが画像リンクの範囲内にある場合は元のMarkdown形式が表示され、編集が可能です。

### リスト機能
- **動的リスト変換**: 
  - 行頭で`- `（ハイフン+スペース）や`* `（アスタリスク+スペース）を入力すると自動的に`·`（中黒）に変換されます
  - `-`や`*`だけでは変換されず、スペースが入力された瞬間に変換されます
- **リスト表示**: `-`や`*`記号を使用したリストが太字の`·`（中黒）で表示されます
- **子アイテムのインデント**: 
  - スペースやタブでインデントされた子アイテムが深いインデントで表示されます
  - 2スペースのインデントは4スペースで表示され、階層構造が明確になります
  - Tabキーで4スペースの深いインデントを追加できます
- **逆変換機能**: 中黒がある行の先頭でBackspaceを押すと`- `に戻ります
- **改行時の継続**: リスト行でEnterを押すと同じインデントレベルで新しい行が作成されます
- **編集可能**: リスト表示中も通常通り編集できます

### コードブロック機能
- **コードブロック表示**: ````言語\nコード```` 形式でコードブロックを作成すると、適切にハイライトされた表示になります。
- **コピー機能**: 各コードブロックの右上にコピーアイコン（📋）が表示され、クリックするとコード内容がクリップボードにコピーされます。
- **言語指定**: ````javascript`、````python` などの言語指定に対応しています。
- **テキスト折り返し**: 長いコード行は自動的に折り返され、横スクロールが不要になります。
- **編集モード**: コードブロック内をクリックすると編集モードに切り替わり、元のMarkdown形式で編集できます。
- **使用例**:
  ```javascript
  function hello() {
    console.log("Hello, World!");
  }
  ```

### 使用方法

1. **ビューを開く**
   - リボンメニュー（左端のサイドバー）にあるSurveyNoteアイコンをクリックします。
   - コマンドパレット（`Ctrl/Cmd + P`）から「SurveyNote表示に切り替え」を実行します。
   - これにより、現在アクティブなMarkdownファイルがSurveyNoteビューで開きます。

2. **編集**
   - SurveyNoteビューでは、各セクションが独立したエディタとして表示されます。
   - Markdown記法が利用でき、スタイルはリアルタイムでプレビューされます。
   - 編集内容は自動で保存されます。

3. **Markdownビューに戻る**
   - SurveyNoteビューのヘッダーにあるファイルアイコン（「Markdown表示に切り替え」）をクリックします。
   - コマンドパレットから「マークダウン表示に切り替え」を実行します。

### データ構造
- このプラグインは、ノートのフロントマターではなく、**Markdown本文**にデータを保存します。
- 各セクションの内容は、以下のようなレベル2ヘッダー��`##`）で区切られます。
  ```markdown
  ## Purpose
  ここに背景や目的を入力します。

  ## Summary
  ここにまとめを入力します。

  ## Content1
  ...
  ```

### レイアウト

SurveyNoteビューでは、以下のようなレイアウトで表示されます：

```
┌─────────────────────────────────────────────────────────────┐
│                      ノートタイトル (編集可能)                  │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────────────┐ ┌────────────────────────┐     │
│  │         Purpose        │ │         Summary        │     │
│  │                        │ │                        │     │
│  │                        │ │                        │     │
│  └────────────────────────┘ └-───────────────────────┘     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐     │
│  │    Content1  │ │  Supplement  │ │    Content2  │     │
│  │              │ │              │ │              │     │
│  │              │ │              │ │              │     │
│  │              │ │              │ │              │     │
│  │              │ │              │ │              │     │
│  └──────────────┘ └──────────────┘ └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
```

## インストール

### 手動インストール
1. このリポジトリの最新リリースから`main.js`、`styles.css`、`manifest.json`をダウンロードします。
2. あなたのVault（保管庫）の`.obsidian/plugins/obsidian-survey-note/`ディレクトリ��、ダウンロードしたファイルをコピーします。（ディレクトリがない場合は作成してください）
3. Obsidianの設定画面でプラグインを有効にします。

### 開発環境での使用
1. このリポジトリをクローンします。
2. `npm install`で依存関係をインストールします。
3. `npm run dev`で開発モードを開始します（ファイル変更時に自動でリビルドされます）。
4. Obsidianでプラグインを有効にします。

## 開発

### 必要環境
- Node.js v16以上
- TypeScript

### 開発コマンド
```bash
npm run dev      # 開発モード（ファイル監視）
npm run build    # プロダクションビルド
npm run version  # バージョン番号の更新
```

### 技術仕様
- **TypeScript**: 型安全性とコード品質の向上
- **Obsidian API**: プラグインの標準APIを使用
- **カスタムビュー**: `ItemView`を活用した独自ビューの実装
- **CodeMirror**: 各セクションに高機能なMarkdownエディタを提供

## 今後のマイルストーン
- [x] 下の段の枠は、最低限の高さ以上に文章が行くと表示エリアを広げるように、枠を広げること。現状は枠の中でスクロール担っているが、ページ全体でスクロールされるようにしたい
- [x] ファイル名入力欄以外の入力欄は、フォーカスしたとき、その枠を目立たせるようにする。
- [x] [[ファイル名]]を内部リンクとして扱えて、クリックしたときにファイルを開ける。
- [x] リンクの扱いを改善する。[]()をURLをリンクとして表示でき、リンクをクリックしたとき、ブラウザをURLでひらける。
- [x] ドラッグアンドドロップで、SurveyNoteプレビューに挿入した画像を、そのままインラインでプレビューできるようにする。
- [x] 画像のインラインで表示させるサイズは変更できる（![[image|300x200]]形式）
- [x] 画像の配置指定（left/center/right）ができる（![[image|center|300x200]]形式）
- [x] URLをはりつけたとき、消える不具合の修正
- [x] ```と```で囲んだコードブロックを、コードブロックは、右上にコピーアイコンを設置して、アイコンをクリップしたらコピーできるようにする
- [x] プロパティを見て、survey-note-view: note なら、survey viewに切り替えをできるボタンを、Markdownビューのタブバーに置く
- [x] プロパティを見て、survey-note-view: note なら、デフォルトで、SurveyViewを表示させる
- [x] -や*のような、·記号を使用したリスト表示してください。
- [x] -や*のような、·記号を使用したリスト表示を切り替えもcmd+zなどで戻れるようにしてください
- [x] 中黒に子アイテムがある場合は、中黒左横にChevronを表示させてください。Chevronをタップしたときに、それより階層が下のアイテムで、次の親アイテムにぶつかるもしくはリストじゃなくなる行の手前の子アイテムまでは、アコーディオンのように閉じたり、開いたり、表示、非表示の状態をコントロールするように、現在の状態のトグルするようにしたい。表示状態によってChevronの向きが変わるようにしたい
- [ ] Markdownに表示切替をクリックしたときに、最初の一度、強制的にSurveyViewが評される不具合がある。
- [ ] 1.2.などによる<ol>の実装して、番号が適切になるようにする
- [ ] tableの実装
- [ ] [[ を入力したときに、最近の利用候補から保管させる
- [ ] チェックボックス


## ライセンス

MIT License

## 貢献

バグ報告や機能要求は、GitHubのIssuesでお知らせください。プルリクエストも歓迎します。

